<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Car Rental PRO â€” Dashboard (Light Modern)</title>

  <!-- Fonts & libs -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    /* ====== Light Modern Theme (RTL) ====== */
    :root{
      --bg: #f7f9fc;
      --sidebar: #0f1724;
      --accent: #3b82f6;
      --muted: #6b7280;
      --card: #ffffff;
      --danger: #ef4444;
      --success: #10b981;
      --text: #0f1724;
      --border: #e6eef6;
    }
    *{box-sizing:border-box;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
    body{margin:0;background:var(--bg);color:var(--text);direction:rtl}
    .app{display:flex;min-height:100vh;}

/* Sidebar */
    .sidebar{
      width:260px;
      background:var(--sidebar);
      color:#fff;
      padding:22px;
      display:flex;
      flex-direction:column;
      gap:12px;
      box-shadow: 4px 0 18px rgba(2,6,23,0.08);
    }
    .logo{font-weight:800;font-size:18px;display:flex;align-items:center;gap:10px}
    .logo .badge{background:var(--accent);color:#fff;padding:6px 10px;border-radius:8px;font-weight:700}
    .small{color:#9aa4b2;font-size:13px}
    .nav{margin-top:6px;display:flex;flex-direction:column;gap:6px}
    .nav button{
      background:transparent;border:none;color:#dbeafe;padding:12px 14px;border-radius:10px;font-weight:600;cursor:pointer;display:flex;justify-content:space-between;align-items:center;
    }
    .nav button.active{background:rgba(255,255,255,0.06);color:#fff}
    .sidebar .foot{margin-top:auto;font-size:13px;color:#93a2b6}

/* Main */
    .main{flex:1;padding:24px;overflow:auto}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:20px}
    .controls{display:flex;gap:8px;align-items:center;}

/* cards */
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow:0 8px 22px rgba(2,6,23,0.04);
    }
    .stat-title{font-size:13px;color:var(--muted);margin-bottom:6px}
    .stat-value{font-size:26px;font-weight:800;color:var(--text)}

/* table */
    table{width:100%;border-collapse:collapse;margin-top:12px;background:transparent}
    thead th{background:#f3f6fb;color:var(--muted);font-weight:700;padding:12px;text-align:right}
    tbody td{background:var(--card);padding:12px;border-bottom:1px solid var(--border);text-align:right}
    tr:hover td{background:#fbfdff}
    .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#8b5cf6);color:#fff}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:var(--text)}
    .btn.danger{background:#fee2e2;color:var(--danger);border:1px solid var(--danger)}
    .tag{padding:5px 10px;border-radius:999px;font-weight:800}
    .tag.in{background:#d1fae5;color:var(--success)}
    .tag.out{background:#fee2e2;color:var(--danger)}

/* forms */
    input,select,textarea{padding:10px;border-radius:8px;border:1px solid var(--border);background:#fff;width:100%}
    .row{display:flex;gap:12px}
    .row .col{flex:1}

/* responsive */
    @media(max-width:980px){
      .grid3{grid-template-columns:1fr}
      .sidebar{display:none}
      .main{padding:16px}
    }
  </style>
</head>
<body>
  <div class="app" id="appRoot">
    <aside class="sidebar" id="sidebar">
      <div class="logo"><div class="badge">CR</div><div>Car Rental <span style="opacity:.8">PRO</span></div></div>
      <div class="small">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <strong id="uiUser">Guest</strong></div>

      <nav class="nav" id="nav">
        <button data-tab="dashboard" class="active">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… <span style="opacity:.7">ğŸ“Š</span></button>
        <button data-tab="cars">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª <span style="opacity:.7">ğŸš˜</span></button>
        <button data-tab="entries">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª <span style="opacity:.7">ğŸ’µ</span></button>
        <button data-tab="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± <span style="opacity:.7">ğŸ“„</span></button>
        <button data-tab="backup">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ <span style="opacity:.7">ğŸ—‚</span></button>
        <button data-tab="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª <span style="opacity:.7">âš™ï¸</span></button>
        <button data-tab="users">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† <span style="opacity:.7">ğŸ‘¥</span></button>
      </nav>

      <div style="margin-top:10px">
        <button id="btnLogin" class="btn ghost" style="width:100%">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / ØªØ¨Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…</button>
      </div>

      <div class="foot small" style="margin-top:auto">
        Ø®Ø§Ø¯Ù… ÙˆÙ‡Ù…ÙŠ â€” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <h1 style="margin:0;font-size:20px">Car Rental PRO â€” Admin Dashboard</h1>
        <div class="controls">
          <label style="font-size:13px;color:var(--muted)">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</label>
          <input type="checkbox" id="autoBackupToggle" />
          <button id="btnDownloadBackup" class="btn ghost">ØªÙ†Ø²ÙŠÙ„</button>
          <button id="btnImportBackup" class="btn primary">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
        </div>
      </div>

      <!-- DASHBOARD -->
      <section id="tab-dashboard" class="tab">
        <h2 style="margin:0 0 12px 0">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
        <div class="grid3" style="margin-bottom:12px">
          <div class="card">
            <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
            <div class="stat-value" id="statRevenue">0</div>
            <div style="margin-top:8px;color:var(--muted);font-weight:600">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ <span style="color:var(--success)">+12%</span></div>
          </div>
          <div class="card">
            <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
            <div class="stat-value" id="statExpenses">0</div>
            <div style="margin-top:8px;color:var(--muted);font-weight:600">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ <span style="color:var(--danger)">-5%</span></div>
          </div>
          <div class="card">
            <div class="stat-title">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
            <div class="stat-value" id="statNet">0</div>
            <div style="margin-top:8px;color:var(--muted);font-weight:600">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ <span style="color:var(--success)">+7%</span></div>
          </div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3>
            <div style="color:var(--muted)">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
          </div>
          <canvas id="chartMonthly" height="100" style="margin-top:16px"></canvas>
        </div>
      </section>

      <!-- CARS -->
      <section id="tab-cars" class="tab" style="display:none">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h3>
            <div style="color:var(--muted)">Ø£Ø¶Ù Ø£Ùˆ Ø¹Ø¯Ù‘Ù„ Ø£Ùˆ Ø§Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
          </div>

          <div style="margin-top:12px" class="row">
            <div class="col"><input id="carName" placeholder="Ø§Ø³Ù…/Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ù…Ø«Ù„Ø§Ù‹: Toyota Corolla 2019)"></div>
            <div style="width:160px"><input id="carPlate" placeholder="Ø§Ù„Ù„ÙˆØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></div>
            <div style="width:160px"><input id="carDailyRent" placeholder="Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ" type="number" min="0" step="0.01"></div>
            <div style="width:120px"><button id="btnAddCar" class="btn primary">Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©</button></div>
          </div>

          <div style="margin-top:14px;overflow:auto">
            <table id="carsTable">
              <thead><tr><th>Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><th>Ø§Ù„Ù„ÙˆØ­Ø©</th><th>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ</th><th>Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ENTRIES -->
      <section id="tab-entries" class="tab" style="display:none">
        <div class="card">
          <h3 style="margin:0">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¯Ø®Ø§Ù„ (Ø¥ÙŠØ±Ø§Ø¯/Ù…ØµØ±ÙˆÙ)</h3>
          <div class="muted" style="margin-top:4px">Ø³Ø¬Ù„ Ø¥ÙŠØ±Ø§Ø¯Ø§Ù‹ Ø£Ùˆ Ù…ØµØ±ÙˆÙØ§Ù‹ Ù„Ø£ÙŠ Ø³ÙŠØ§Ø±Ø©</div>

          <div style="margin-top:12px" class="row">
            <div class="col">
              <select id="entryCar"><option value="all">Ø§Ø®ØªØ± Ø³ÙŠØ§Ø±Ø©</option></select>
            </div>
            <div style="width:170px"><input id="entryDate" type="date" /></div>
            <div style="width:140px">
              <select id="entryType"><option value="income">Ø¥ÙŠØ±Ø§Ø¯</option><option value="expense">Ù…ØµØ±ÙˆÙ</option></select>
            </div>
          </div>

          <div style="margin-top:10px" class="row">
            <div class="col"><input id="entryAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø±Ù‚Ù…ÙŠ)" type="number" step="0.01" /></div>
            <div class="col"><input id="entryCategory" placeholder="Ø§Ù„ÙØ¦Ø© (Ù…Ø«Ù„Ø§Ù‹: Ø¥ÙŠØ¬Ø§Ø±ØŒ ÙˆÙ‚ÙˆØ¯ØŒ ØµÙŠØ§Ù†Ø©)" /></div>
            <div style="width:160px"><button id="btnAddEntry" class="btn primary">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</button></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª</h3>
            <div>
              <select id="filterCar" style="width:140px"><option value="all">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option></select>
              <input id="filterFrom" type="date" style="width:140px" />
              <input id="filterTo" type="date" style="width:140px" />
              <button id="btnApplyFilter" class="btn ghost">ØªØ·Ø¨ÙŠÙ‚</button>
              <button id="btnClearFilter" class="btn ghost">Ù…Ø³Ø­</button>
            </div>
          </div>

          <div style="margin-top:12px;overflow:auto">
            <table id="entriesTable">
              <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- REPORTS -->
      <section id="tab-reports" class="tab" style="display:none">
        <div class="card">
          <h3 style="margin:0">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
          <div class="muted" style="margin-top:6px">ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø®ØµØµØ© + ØªØµØ¯ÙŠØ± CSV / Excel / PDF</div>

          <div style="margin-top:12px" class="row">
            <div class="col"><select id="reportCar"><option value="all">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option></select></div>
            <div style="width:170px"><input id="reportFrom" type="date" /></div>
            <div style="width:170px"><input id="reportTo" type="date" /></div>
            <div style="width:130px"><button id="btnGenerate" class="btn primary">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button></div>
          </div>

          <div id="reportSummary" class="card" style="margin-top:12px">
            <p class="muted">Ø§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‡Ù†Ø§.</p>
          </div>

          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="btnExportCSVReport" class="btn ghost">ØªØµØ¯ÙŠØ± CSV</button>
            <button id="btnExportXLS" class="btn ghost">ØªØµØ¯ÙŠØ± Excel</button>
            <button id="btnExportPDF" class="btn primary">ØªØµØ¯ÙŠØ± PDF</button>
          </div>
        </div>
      </section>

      <!-- BACKUP -->
      <section id="tab-backup" class="tab" style="display:none">
        <div class="card">
          <h3>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</h3>
          <div class="muted" style="margin-top:6px">ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© JSON Ø£Ùˆ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù„Ù. Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ localStorage.</div>

          <div style="margin-top:12px" class="row">
            <div style="width:160px"><button id="btnDownload" class="btn primary">ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button></div>
            <div style="width:160px"><button id="btnUpload" class="btn ghost">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø©</button></div>
            <div style="width:200px"><button id="btnClearAll" class="btn danger">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button></div>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="tab-settings" class="tab" style="display:none">
        <div class="card">
          <h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
          <div class="muted" style="margin-top:6px">Ø§Ù„Ø¹Ù…Ù„Ø©ØŒ ÙØ§ØµÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ Ø§Ù„Ø³Ù…Ø©</div>

          <div style="margin-top:12px">
            <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0">
              <div>
                <div style="font-weight:700">Ø§Ù„Ø¹Ù…Ù„Ø©</div>
                <div class="muted">Ø§Ø®ØªØ± Ø¹Ù…Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶</div>
              </div>
              <div style="width:200px"><input id="settingCurrency" value="MRU" /></div>
            </div>

            <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0">
              <div>
                <div style="font-weight:700">ÙØ§ØµÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Ø¯Ù‚Ø§Ø¦Ù‚)</div>
                <div class="muted">ÙƒÙ… Ù…Ø±Ø© ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
              </div>
              <div style="width:220px"><input id="settingAutoInterval" type="number" min="1" value="60" /></div>
            </div>

            <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0">
              <div>
                <div style="font-weight:700">Ø§Ù„Ø³Ù…Ø©</div>
                <div class="muted">ÙØ§ØªØ­ / Ø¯Ø§ÙƒÙ†</div>
              </div>
              <div style="width:160px">
                <select id="settingTheme"><option value="light">ÙØ§ØªØ­</option><option value="dark">Ø¯Ø§ÙƒÙ†</option></select>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- USERS -->
      <section id="tab-users" class="tab" style="display:none">
        <div class="card">
          <h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø±</h3>
          <div class="muted" style="margin-top:6px">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù…ØµØ§Ø¯Ù‚Ø© ÙˆÙ‡Ù…ÙŠØ©)</div>

          <div style="margin-top:12px" class="row">
            <div class="col"><input id="newUserName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" /></div>
            <div class="col"><input id="newUserEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" /></div>
            <div style="width:160px"><select id="newUserRole"><option value="admin">Ù…Ø´Ø±Ù</option><option value="manager">Ù…Ø¯ÙŠØ±</option><option value="user">Ù…Ø³ØªØ®Ø¯Ù…</option></select></div>
            <div style="width:120px"><button id="btnAddUser" class="btn primary">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button></div>
          </div>

          <div style="margin-top:12px">
            <table id="usersTable"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody></tbody></table>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Login modal -->
  <div id="modalLogin" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.6);align-items:center;justify-content:center;z-index:50">
    <div style="background:#fff;padding:20px;border-radius:12px;width:420px;text-align:right;">
      <h3 style="margin:0 0 10px 0">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ØªØ¬Ø±ÙŠØ¨ÙŠ)</h3>
      <div class="small muted">ØªØ¬Ø±ÙŠØ¨ÙŠ: admin@demo (Ù…Ø´Ø±Ù)ØŒ manager@demo (Ù…Ø¯ÙŠØ±)ØŒ user@demo (Ù…Ø³ØªØ®Ø¯Ù…) â€” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: 123456</div>
      <div style="margin-top:12px" class="row">
        <div class="col"><input id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" value="admin@demo" /></div>
        <div style="width:160px"><input id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="123456" /></div>
      </div>
      <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
        <button id="btnDoLogin" class="btn primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <button id="btnCloseLogin" class="btn ghost">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

<script>
/* ============================
   Full functionality JS
   - keeps original features
   - robust DOMContentLoaded initialization
   ============================ */

document.addEventListener('DOMContentLoaded', ()=> {

  // STORAGE KEYS
  const STORAGE_KEY = 'car_rental_pro_v1';
  const AUTO_BACKUP_KEY = 'car_rental_pro_autobackup';
  const LAST_RENT_DATE_KEY = 'cr_last_rent_date';
  let autoBackupTimer = null;
  let monthlyChart = null;

  // DEFAULT STATE
  function defaultState(){
    const today = new Date().toISOString().slice(0,10);
    return {
      users:[
        {id:1,name:'Administrator',email:'admin@demo',password:'123456',role:'admin'},
        {id:2,name:'Manager',email:'manager@demo',password:'123456',role:'manager'},
        {id:3,name:'Staff',email:'user@demo',password:'123456',role:'user'}
      ],
      cars:[
        {id:'c1',name:'Toyota Corolla 2019',plate:'T-1234',dailyRent:1500},
        {id:'c2',name:'Hyundai Accent 2018',plate:'H-4321',dailyRent:900}
      ],
      entries:[
        {id:'e1',carId:'c1',date:today,type:'income',amount:1200,category:'Daily rent',note:'Daily rent'},
        {id:'e2',carId:'c2',date:today,type:'expense',amount:200,category:'Fuel',note:'Fuel refill'}
      ],
      settings:{currency:'MRU',autoBackupIntervalMinutes:60,theme:'light'}
    };
  }

  // LOAD & SAVE
  let state = (function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw){ const s = defaultState(); localStorage.setItem(STORAGE_KEY,JSON.stringify(s)); return s; }
      return JSON.parse(raw);
    }catch(e){ console.error('load error',e); const s = defaultState(); localStorage.setItem(STORAGE_KEY,JSON.stringify(s)); return s; }
  })();

  let currentUser = JSON.parse(localStorage.getItem('cr_current_user') || 'null');

  function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

  // HELPERS
  function escapeHtml(str){ if(typeof str !== 'string') return str; return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }
  function formatMoney(amount){
    const currency = state.settings.currency || 'MRU';
    if(isNaN(Number(amount))) amount = 0;
    // show with thousands, no currency symbol, then append currency code
    const formatted = Number(amount).toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:2});
    return formatted + ' ' + currency;
  }
  function downloadFile(filename, contentType, content){
    const a = document.createElement('a');
    const blob = new Blob([content],{type:contentType});
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  /* ------------------------------
     Daily Rent Automation
  ------------------------------ */
  function processDailyRent(){
    const today = new Date().toISOString().slice(0,10);
    const last = localStorage.getItem(LAST_RENT_DATE_KEY);
    if(last === today) return;
    state.cars.forEach(car=>{
      const rent = parseFloat(car.dailyRent) || 0;
      if(rent > 0){
        const exists = state.entries.some(e => e.carId === car.id && e.date === today && e.category === 'Daily Automated Rent');
        if(!exists){
          const id = 'e'+Date.now().toString(36)+Math.random().toString(36).slice(2,6);
          state.entries.push({id,carId:car.id,date:today,type:'income',amount:rent,category:'Daily Automated Rent',note:`Daily Rent - ${car.name}`});
        }
      }
    });
    if(state.cars.some(c=>parseFloat(c.dailyRent)>0)){
      saveState();
      localStorage.setItem(LAST_RENT_DATE_KEY, today);
    }
  }

  /* ------------------------------
     UI Helpers & Tabs
  ------------------------------ */
  const navButtons = document.querySelectorAll('#nav button');
  navButtons.forEach(btn=>{
    btn.addEventListener('click', ()=> {
      navButtons.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      showTab(btn.dataset.tab);
    });
  });

  function showTab(id){
    document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
    const el = document.getElementById('tab-'+id);
    if(el) el.style.display = 'block';
    // render relevant parts
    if(id==='cars') renderCarsTable();
    if(id==='entries') renderEntriesTable();
    if(id==='reports') renderReportSummary();
    if(id==='users') renderUsers();
    if(id==='dashboard') updateDashboard();
    document.getElementById('uiUser').innerText = currentUser ? `${currentUser.name} (${currentUser.role})` : 'Guest';
  }

  /* ------------------------------
     Charts (monthly)
  ------------------------------ */
  function updateMonthlyChart(){
    const now = new Date();
    const months = [];
    const revData = [], expData = [];
    for(let i=11;i>=0;i--){
      const d = new Date(now.getFullYear(), now.getMonth()-i,1);
      const key = d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0');
      months.push(d.toLocaleString('default',{month:'short',year:'numeric'}));
      const entries = state.entries.filter(en=> en.date.startsWith(key));
      const rev = entries.filter(e=>e.type==='income').reduce((s,e)=>s+Number(e.amount),0);
      const exp = entries.filter(e=>e.type==='expense').reduce((s,e)=>s+Number(e.amount),0);
      revData.push(rev); expData.push(exp);
    }
    const ctx = document.getElementById('chartMonthly').getContext('2d');
    if(monthlyChart) monthlyChart.destroy();
    monthlyChart = new Chart(ctx, {
      type:'line',
      data:{labels:months,datasets:[
        {label:'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª',data:revData,tension:0.3,borderColor:'#06b6d4',backgroundColor:'rgba(6,182,212,0.06)',fill:true},
        {label:'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',data:expData,tension:0.3,borderColor:'#ef4444',backgroundColor:'rgba(239,68,68,0.06)',fill:true}
      ]},
      options:{responsive:true,plugins:{legend:{position:'top'}}}
    });
  }

  /* ------------------------------
     Dashboard numbers
  ------------------------------ */
  function updateDashboard(){
    const rev = state.entries.filter(e=>e.type==='income').reduce((s,e)=>s+Number(e.amount),0);
    const exp = state.entries.filter(e=>e.type==='expense').reduce((s,e)=>s+Number(e.amount),0);
    document.getElementById('statRevenue').innerText = formatMoney(rev);
    document.getElementById('statExpenses').innerText = formatMoney(exp);
    document.getElementById('statNet').innerText = formatMoney(rev-exp);
    updateMonthlyChart();
  }

  /* ------------------------------
     Cars Table
  ------------------------------ */
  function renderCarsTable(){
    const tbody = document.querySelector('#carsTable tbody');
    tbody.innerHTML = '';
    state.cars.forEach(c=>{
      const count = state.entries.filter(e=>e.carId===c.id).length;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${escapeHtml(c.name)}</td>
        <td>${escapeHtml(c.plate||'')}</td>
        <td style="font-weight:700">${formatMoney(c.dailyRent||0)}</td>
        <td class="muted">${count} Ø¥Ø¯Ø®Ø§Ù„Ø§Øª</td>
        <td style="text-align:left">
          <button class="btn ghost" data-act="edit" data-id="${c.id}">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn danger" data-act="del" data-id="${c.id}">Ø­Ø°Ù</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  /* ------------------------------
     Populate selects for cars
  ------------------------------ */
  function populateCarSelects(){
    const selects = ['entryCar','filterCar','reportCar'];
    selects.forEach(id=>{
      const el = document.getElementById(id);
      if(!el) return;
      const currentVal = el.value;
      el.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>';
      state.cars.forEach(c=> el.insertAdjacentHTML('beforeend', `<option value="${c.id}">${escapeHtml(c.name)}</option>`));
      el.value = currentVal || 'all';
    });
  }

  /* ------------------------------
     Entries Table
  ------------------------------ */
  function renderEntriesTable(){
    populateCarSelects();
    const tbody = document.querySelector('#entriesTable tbody');
    tbody.innerHTML = '';
    let rows = state.entries.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
    const carFilter = document.getElementById('filterCar').value;
    const from = document.getElementById('filterFrom').value;
    const to = document.getElementById('filterTo').value;
    if(carFilter && carFilter!=='all') rows = rows.filter(r=> r.carId===carFilter);
    if(from) rows = rows.filter(r=> r.date >= from);
    if(to) rows = rows.filter(r=> r.date <= to);

    rows.forEach(e=>{
      const car = state.cars.find(c=>c.id===e.carId);
      const tr = document.createElement('tr');
      const typeTag = e.type==='income' ? '<span class="tag in">Ø¥ÙŠØ±Ø§Ø¯</span>' : '<span class="tag out">Ù…ØµØ±ÙˆÙ</span>';
      tr.innerHTML = `<td>${e.date}</td>
        <td>${escapeHtml(car?car.name:'-')}</td>
        <td>${typeTag}</td>
        <td>${escapeHtml(e.category||'')}</td>
        <td style="font-weight:800">${formatMoney(e.amount)}</td>
        <td>${escapeHtml(e.note||'')}</td>
        <td style="text-align:left">
          <button class="btn ghost" data-act="edit-entry" data-id="${e.id}">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn danger" data-act="del-entry" data-id="${e.id}">Ø­Ø°Ù</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  /* ------------------------------
     Reports Summary & Table
  ------------------------------ */
  function renderReportSummary(){
    const carId = document.getElementById('reportCar').value;
    const from = document.getElementById('reportFrom').value;
    const to = document.getElementById('reportTo').value;
    let rows = state.entries.slice();
    if(carId && carId!=='all') rows = rows.filter(r=>r.carId===carId);
    if(from) rows = rows.filter(r=>r.date>=from);
    if(to) rows = rows.filter(r=>r.date<=to);
    const income = rows.filter(r=>r.type==='income').reduce((s,r)=>s+Number(r.amount),0);
    const expense = rows.filter(r=>r.type==='expense').reduce((s,r)=>s+Number(r.amount),0);
    const net = income - expense;
    const out = document.getElementById('reportSummary');
    out.innerHTML = `<div style="display:flex;gap:16px; flex-wrap: wrap;">
      <div class="card" style="flex:1; min-width: 150px;"><div class="muted">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div><div style="font-weight:800;font-size:20px">${formatMoney(income)}</div></div>
      <div class="card" style="flex:1; min-width: 150px;"><div class="muted">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div><div style="font-weight:800;font-size:20px">${formatMoney(expense)}</div></div>
      <div class="card" style="flex:1; min-width: 150px;"><div class="muted">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div><div style="font-weight:800;font-size:20px">${formatMoney(net)}</div></div>
      </div>
      <div style="margin-top:12px">
        <table style="width:100%"><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead>
        <tbody>${rows.map(r=>`<tr><td>${r.date}</td><td>${escapeHtml((state.cars.find(c=>c.id===r.carId)||{}).name||'-')}</td><td>${r.type === 'income' ? 'Ø¥ÙŠØ±Ø§Ø¯' : 'Ù…ØµØ±ÙˆÙ'}</td><td>${escapeHtml(r.category||'')}</td><td style="font-weight:700">${formatMoney(r.amount)}</td></tr>`).join('')}</tbody></table>
      </div>`;
  }

  /* ------------------------------
     Export CSV / XLS / PDF for report
  ------------------------------ */
  document.getElementById('btnExportCSVReport').addEventListener('click', ()=>{
    const carId = document.getElementById('reportCar').value;
    const from = document.getElementById('reportFrom').value;
    const to = document.getElementById('reportTo').value;
    let rows = state.entries.slice();
    if(carId && carId!=='all') rows = rows.filter(r=>r.carId===carId);
    if(from) rows = rows.filter(r=>r.date>=from);
    if(to) rows = rows.filter(r=>r.date<=to);
    let csv = 'Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ø³ÙŠØ§Ø±Ø©,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„ÙØ¦Ø©,Ø§Ù„Ù…Ø¨Ù„Øº\n';
    rows.forEach(r=> csv += `${r.date},${(state.cars.find(c=>c.id===r.carId)||{}).name || ''},${r.type === 'income' ? 'Ø¥ÙŠØ±Ø§Ø¯' : 'Ù…ØµØ±ÙˆÙ'},${r.category || ''},${r.amount}\n`);
    downloadFile('report.csv','text/csv;charset=utf-8;',csv);
  });

  document.getElementById('btnExportXLS').addEventListener('click', ()=>{
    const carId = document.getElementById('reportCar').value;
    const from = document.getElementById('reportFrom').value;
    const to = document.getElementById('reportTo').value;
    let rows = state.entries.slice();
    if(carId && carId!=='all') rows = rows.filter(r=>r.carId===carId);
    if(from) rows = rows.filter(r=>r.date>=from);
    if(to) rows = rows.filter(r=>r.date<=to);
    const wsData = [['Ø§Ù„ØªØ§Ø±ÙŠØ®','Ø§Ù„Ø³ÙŠØ§Ø±Ø©','Ø§Ù„Ù†ÙˆØ¹','Ø§Ù„ÙØ¦Ø©','Ø§Ù„Ù…Ø¨Ù„Øº']];
    rows.forEach(r=> wsData.push([r.date,(state.cars.find(c=>c.id===r.carId)||{}).name||'',r.type === 'income' ? 'Ø¥ÙŠØ±Ø§Ø¯' : 'Ù…ØµØ±ÙˆÙ',r.category||'',r.amount]));
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(wsData);
    XLSX.utils.book_append_sheet(wb, ws, 'Report');
    XLSX.writeFile(wb,'report.xlsx');
  });

  document.getElementById('btnExportPDF').addEventListener('click', async ()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({unit:'pt',format:'a4'});
    doc.setFontSize(14);
    doc.text('Car Rental Report',40,40);
    doc.setFontSize(10);
    doc.text('Summary:',40,60);
    const income = state.entries.filter(r=>r.type==='income').reduce((s,r)=>s+Number(r.amount),0);
    const expense = state.entries.filter(r=>r.type==='expense').reduce((s,r)=>s+Number(r.amount),0);
    const net = income - expense;
    doc.text(`Revenue: ${formatMoney(income)} | Expenses: ${formatMoney(expense)} | Net: ${formatMoney(net)}`,40,75);
    doc.save('report.pdf');
  });

  /* ------------------------------
     Users rendering
  ------------------------------ */
  function renderUsers(){
    const tbody = document.querySelector('#usersTable tbody');
    tbody.innerHTML = '';
    state.users.forEach(u=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${escapeHtml(u.name)}</td><td>${escapeHtml(u.email)}</td><td>${escapeHtml(u.role)}</td>
        <td style="text-align:left">
          <button class="btn ghost" data-act="impersonate" data-id="${u.id}">Ø§Ù†ØªØ­Ø§Ù„</button>
          <button class="btn danger" data-act="del-user" data-id="${u.id}">Ø­Ø°Ù</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  /* ------------------------------
     EVENTS & ACTIONS
  ------------------------------ */
  // Add car
  document.getElementById('btnAddCar').addEventListener('click', ()=>{
    const name = document.getElementById('carName').value.trim();
    const plate = document.getElementById('carPlate').value.trim();
    const dailyRent = parseFloat(document.getElementById('carDailyRent').value) || 0;
    if(!name) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
    const id = 'c'+Date.now().toString(36)+Math.random().toString(36).slice(2,6);
    state.cars.push({id,name,plate,dailyRent});
    saveState();
    document.getElementById('carName').value=''; document.getElementById('carPlate').value=''; document.getElementById('carDailyRent').value='';
    renderCarsTable(); populateCarSelects(); updateDashboard();
  });

  // cars table actions (edit/delete)
  document.querySelector('#carsTable tbody').addEventListener('click',(ev)=>{
    const btn = ev.target.closest('button'); if(!btn) return;
    const act = btn.dataset.act; const id = btn.dataset.id;
    if(act==='del'){
      if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ¥Ø¯Ø®Ø§Ù„Ø§ØªÙ‡Ø§ØŸ')) return;
      state.cars = state.cars.filter(c=>c.id!==id);
      state.entries = state.entries.filter(e=>e.carId!==id);
      saveState(); renderCarsTable(); renderEntriesTable(); updateDashboard();
    } else if(act==='edit'){
      const car = state.cars.find(c=>c.id===id);
      const newName = prompt('Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©', car.name);
      const newRent = prompt('Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ', car.dailyRent);
      let updated=false;
      if(newName!==null && newName!==car.name){ car.name=newName; updated=true;}
      if(newRent!==null && !isNaN(parseFloat(newRent)) && parseFloat(newRent)!==car.dailyRent){ car.dailyRent=parseFloat(newRent); updated=true;}
      if(updated){ saveState(); renderCarsTable(); populateCarSelects(); renderEntriesTable(); updateDashboard(); }
    }
  });

  // add entry
  document.getElementById('btnAddEntry').addEventListener('click', ()=>{
    const carId = document.getElementById('entryCar').value;
    const date = document.getElementById('entryDate').value || new Date().toISOString().slice(0,10);
    const type = document.getElementById('entryType').value;
    const amount = parseFloat(document.getElementById('entryAmount').value);
    const category = document.getElementById('entryCategory').value.trim();
    if(!carId || carId==='all') return alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ§Ø±Ø©');
    if(isNaN(amount) || amount<=0) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
    const id = 'e'+Date.now().toString(36)+Math.random().toString(36).slice(2,6);
    state.entries.push({id,carId,date,type,amount,category:category||'N/A',note:''});
    saveState();
    document.getElementById('entryAmount').value=''; document.getElementById('entryCategory').value='';
    renderEntriesTable(); updateDashboard();
  });

  // entries actions edit/delete
  document.querySelector('#entriesTable tbody').addEventListener('click', (ev)=>{
    const btn = ev.target.closest('button'); if(!btn) return;
    const act = btn.dataset.act; const id = btn.dataset.id;
    const entry = state.entries.find(e=>e.id===id);
    if(!entry) return;
    if(act==='del-entry'){
      if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ØŸ')) return;
      state.entries = state.entries.filter(e=>e.id!==id);
      saveState(); renderEntriesTable(); updateDashboard();
    } else if(act==='edit-entry'){
      const newAmount = prompt('Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯', entry.amount);
      const newCategory = prompt('Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', entry.category);
      if(newAmount!==null && !isNaN(parseFloat(newAmount)) && parseFloat(newAmount)>0){
        entry.amount = parseFloat(newAmount);
        entry.category = newCategory || entry.category;
        saveState(); renderEntriesTable(); updateDashboard();
      } else if(newCategory!==null){
        entry.category = newCategory || entry.category;
        saveState(); renderEntriesTable(); updateDashboard();
      }
    }
  });

  // filters
  document.getElementById('btnApplyFilter').addEventListener('click', ()=> renderEntriesTable());
  document.getElementById('btnClearFilter').addEventListener('click', ()=>{
    document.getElementById('filterCar').value='all';
    document.getElementById('filterFrom').value=''; document.getElementById('filterTo').value='';
    renderEntriesTable();
  });

  // report generation
  document.getElementById('btnGenerate').addEventListener('click', ()=> renderReportSummary());

  // backup download
  document.getElementById('btnDownload').addEventListener('click', ()=> {
    const blob = JSON.stringify(state,null,2);
    downloadFile(`car_rental_pro_backup_${new Date().toISOString().slice(0,10)}.json`,'application/json;charset=utf-8;',blob);
  });

  // upload restore
  document.getElementById('btnUpload').addEventListener('click', ()=> {
    const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
    inp.onchange = (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = (ev)=>{
        try{
          const imported = JSON.parse(ev.target.result);
          if(imported.cars && imported.entries && imported.users){
            if(!confirm('Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø³ØªØ­Ù„ Ù…Ø­Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ ØªØªØ§Ø¨Ø¹ØŸ')) return;
            state = imported; saveState(); renderAll(); alert('ØªÙ…Øª Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
          } else throw new Error('Invalid file');
        }catch(err){ alert('ÙØ´Ù„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©. Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­.'); }
      };
      reader.readAsText(file);
    };
    inp.click();
  });

  // clear all
  document.getElementById('btnClearAll').addEventListener('click', ()=>{
    if(!confirm('ØªØ­Ø°ÙŠØ±: Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø³ÙŠØ­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!')) return;
    localStorage.removeItem(STORAGE_KEY); localStorage.removeItem(AUTO_BACKUP_KEY); localStorage.removeItem(LAST_RENT_DATE_KEY);
    localStorage.removeItem('cr_current_user');
    state = defaultState(); saveState(); renderAll(); alert('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†');
  });

  // auto backup toggle + download button
  document.getElementById('autoBackupToggle').addEventListener('change', setupAutoBackup);
  document.getElementById('btnDownloadBackup').addEventListener('click', ()=>{
    const copy = JSON.stringify(state,null,2);
    downloadFile('autobackup.json','application/json;charset=utf-8;',copy);
  });

  function setupAutoBackup(){
    if(autoBackupTimer) clearInterval(autoBackupTimer);
    const enabled = document.getElementById('autoBackupToggle').checked;
    localStorage.setItem(AUTO_BACKUP_KEY, JSON.stringify({enabled,ts:Date.now()}));
    if(enabled){
      const minutes = parseInt(document.getElementById('settingAutoInterval').value || '60',10);
      autoBackupTimer = setInterval(()=> {
        localStorage.setItem('car_rental_pro_autobackup', JSON.stringify({ts:Date.now(),state}));
        console.log('Auto backup saved');
      }, Math.max(1, minutes) * 60 * 1000);
    }
  }

  // settings change handlers
  document.getElementById('settingAutoInterval').addEventListener('change', ()=>{
    state.settings.autoBackupIntervalMinutes = parseInt(document.getElementById('settingAutoInterval').value||'60',10);
    saveState(); setupAutoBackup();
  });
  document.getElementById('settingCurrency').addEventListener('change', ()=>{
    state.settings.currency = document.getElementById('settingCurrency').value.trim();
    saveState(); updateDashboard();
  });

  // theme switch
  document.getElementById('settingTheme').addEventListener('change', (e)=>{
    state.settings.theme = e.target.value; saveState();
    if(e.target.value==='dark'){
      document.body.style.background = '#0b1220'; document.body.style.color = '#fff';
    } else {
      document.body.style.background = 'var(--bg)'; document.body.style.color = 'var(--text)';
    }
  });

  // users
  document.getElementById('btnAddUser').addEventListener('click', ()=>{
    const name = document.getElementById('newUserName').value.trim();
    const email = document.getElementById('newUserEmail').value.trim();
    const role = document.getElementById('newUserRole').value;
    if(!name||!email) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯');
    if(state.users.some(u=>u.email===email)) return alert('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
    const id = Date.now();
    state.users.push({id,name,email,password:'123456',role}); saveState(); document.getElementById('newUserName').value=''; document.getElementById('newUserEmail').value=''; renderUsers(); alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:123456)');
  });

  document.querySelector('#usersTable tbody').addEventListener('click',(ev)=>{
    const btn = ev.target.closest('button'); if(!btn) return;
    const act = btn.dataset.act; const id = parseInt(btn.dataset.id,10);
    if(act==='del-user'){
      if(currentUser && currentUser.id===id) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ');
      if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
      state.users = state.users.filter(u=>u.id!==id); saveState(); renderUsers();
    } else if(act==='impersonate'){
      const user = state.users.find(u=>u.id===id);
      if(user){ currentUser = user; localStorage.setItem('cr_current_user', JSON.stringify(currentUser)); showTab('dashboard'); alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ ${user.name}`); }
    }
  });

  // login modal
  document.getElementById('btnLogin').addEventListener('click', ()=> document.getElementById('modalLogin').style.display='flex');
  document.getElementById('btnCloseLogin').addEventListener('click', ()=> document.getElementById('modalLogin').style.display='none');
  document.getElementById('btnDoLogin').addEventListener('click', ()=>{
    const email = document.getElementById('loginEmail').value.trim();
    const pass = document.getElementById('loginPass').value.trim();
    const user = state.users.find(u=>u.email===email && u.password===pass);
    if(user){ currentUser = user; localStorage.setItem('cr_current_user', JSON.stringify(currentUser)); document.getElementById('modalLogin').style.display='none'; showTab('dashboard'); alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ ${user.name}`); }
    else alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
  });

  // entries table actions (already handled above)
  // report generation hooked above

  // helper render all
  function renderAll(){
    populateCarSelects();
    renderCarsTable();
    renderEntriesTable();
    renderUsers();
    updateDashboard();
    // set settings UI values
    document.getElementById('settingCurrency').value = state.settings.currency || 'MRU';
    document.getElementById('settingAutoInterval').value = state.settings.autoBackupIntervalMinutes || 60;
    document.getElementById('settingTheme').value = state.settings.theme || 'light';
    // auto backup toggle from storage
    const raw = JSON.parse(localStorage.getItem(AUTO_BACKUP_KEY) || 'null');
    document.getElementById('autoBackupToggle').checked = !!(raw && raw.enabled);
    setupAutoBackup();
    // set entry date default
    const ed = document.getElementById('entryDate');
    if(ed) ed.value = new Date().toISOString().slice(0,10);
  }

  // initial run
  processDailyRent();
  renderAll();

  // helper to re-render everything when needed
  window.renderAll = renderAll;
  window.saveState = saveState;

}); // DOMContentLoaded end
</script>
</body>
</html>
