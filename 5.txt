<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Car Rental PRO â€” Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
/* ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø¯Ø§ÙƒÙ† (Sidebar) ÙˆØ§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ§ØªØ­Ø© (BG) */
:root{
Â  Â  --bg:#f5f7fb;
Â  Â  --sidebar:#131427; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¯Ø§ÙƒÙ† Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
Â  Â  --accent:#5eead4;
Â  Â  --muted:#6b7280;
Â  Â  --card:#ffffff;
Â  Â  --danger:#ef4444;
Â  Â  --success:#10b981;
}
/* Ø¥ØµÙ„Ø§Ø­ Ø¨Ø³ÙŠØ·: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØªØ³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø®Ø· */
*{box-sizing:border-box;font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
body{margin:0;background:var(--bg);color:#0f1724}

/* ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø³Ù… Ù„Ø¶Ù…Ø§Ù† Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© */
.app{display:flex;height:100vh;overflow:hidden}

/* Sidebar Styling - ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù„ÙˆÙ†ÙŠ Ø§Ù„Ø¯Ø§ÙƒÙ† Ù‡Ù†Ø§ */
.sidebar{
    width:280px;
    background:linear-gradient(180deg,var(--sidebar),#0e1220);
    color:#fff;
    padding:22px;
    display:flex;
    flex-direction:column;
    gap:12px
}
.logo{font-weight:800;font-size:18px;display:flex;align-items:center;gap:10px}
.logo .badge{background:var(--accent);color:#012;padding:6px 10px;border-radius:10px;font-weight:700}
.nav{margin-top:6px;display:flex;flex-direction:column;gap:6px}
.nav button{background:transparent;border:none;color:#dbeafe;padding:12px 14px;text-align:right;border-radius:10px;font-weight:600;cursor:pointer;display:flex;justify-content:space-between;align-items:center; direction: rtl;}
.nav button.active{background:rgba(255,255,255,0.06)}
.small{color:#9aa4b2;font-size:13px}
.sidebar .foot{margin-top:auto;font-size:13px;color:#93a2b6}

/* Main area */
.main{flex:1;padding:20px;overflow:auto}
.topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:linear-gradient(90deg,#06b6d4,#8b5cf6);border:none;color:#021;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
.btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.08);color:inherit}
.card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06);margin-bottom:16px}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.stat-title{font-size:13px;color:var(--muted)}
.stat-value{font-size:24px;font-weight:800;margin-top:6px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #eef2f7;text-align:right;font-size:14px}
input,select,textarea{padding:10px;border-radius:8px;border:1px solid #e6eef6;background:#fff;width:100%;font-size:14px}
.row{display:flex;gap:10px}
.row .col{flex:1}
.tag{padding:6px 8px;border-radius:999px;font-weight:700; text-align: center;}
.tag.in{background:var(--success);color:#021}
.tag.out{background:var(--danger);color:#021}
.muted{color:var(--muted)}
.settings-line{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 0;border-top:1px dashed #eef2f7}
/* responsive */
@media(max-width:980px){
Â  Â  .grid3{grid-template-columns:1fr}
Â  Â  .sidebar{display:none}
Â  Â  .app.mobile .sidebar{display:block;position:fixed;z-index:40;left:0;top:0;height:100vh}
}
</style>
</head>
<body>

<div class="app" id="appRoot">

Â  Â  <aside class="sidebar" id="sidebar">
Â  Â  <div class="logo"><div class="badge">CR</div><div>Car Rental <span class="muted">PRO</span></div></div>
Â  Â  <div class="small">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <strong id="uiUser">Guest</strong></div>

Â  Â  <nav class="nav" id="nav">
Â  Â  Â  <button data-tab="dashboard" class="active">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… <span class="muted">ğŸ“Š</span></button>
Â  Â  Â  <button data-tab="cars">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª <span class="muted">ğŸš˜</span></button>
Â  Â  Â  <button data-tab="entries">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª <span class="muted">ğŸ’µ</span></button>
Â  Â  Â  <button data-tab="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± <span class="muted">ğŸ“„</span></button>
Â  Â  Â  <button data-tab="backup">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„ØªØµØ¯ÙŠØ± <span class="muted">ğŸ—‚</span></button>
Â  Â  Â  <button data-tab="settings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª <span class="muted">âš™ï¸</span></button>
Â  Â  Â  <button data-tab="users">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø± <span class="muted">ğŸ‘¥</span></button>
Â  Â  </nav>

Â  Â  <div style="margin-top:10px">
Â  Â  Â  <button id="btnLogin" class="btn ghost" style="width:100%">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
Â  Â  </div>

Â  Â  <div class="foot muted" style="margin-top:auto">
Â  Â  Â  Ø®Ø§Ø¯Ù… ÙˆÙ‡Ù…ÙŠ Ù…Ø­Ù„ÙŠ â€” Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø®Ø§Ø±Ø¬ÙŠ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²Ù†Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ.
Â  Â  </div>
Â  </aside>

Â  Â  <main class="main">
Â  Â  <div class="topbar">
Â  Â  Â  <h1 style="margin:0">Car Rental PRO â€” Admin Dashboard</h1>
Â  Â  Â  <div class="controls">
Â  Â  Â  Â  <label class="muted" style="font-size:13px">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</label>
Â  Â  Â  Â  <input type="checkbox" id="autoBackupToggle" />
Â  Â  Â  Â  <button id="btnDownloadBackup" class="btn ghost">ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
Â  Â  Â  Â  <button id="btnImportBackup" class="btn">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <section id="tab-dashboard" class="tab">
Â  Â  Â  <h2 style="margin:0 0 12px 0;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
Â  Â  Â  <div class="grid3" style="margin-bottom:12px">
Â  Â  Â  Â  <div class="card stat-box">
Â  Â  Â  Â  Â  <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
Â  Â  Â  Â  Â  <div class="stat-value" id="statRevenue">0</div>
Â  Â  Â  Â  Â  <div class="small muted">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ <span style="color:var(--success)">+12%</span></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card stat-box">
Â  Â  Â  Â  Â  <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
Â  Â  Â  Â  Â  <div class="stat-value" id="statExpenses">0</div>
Â  Â  Â  Â  Â  <div class="small muted">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ <span style="color:var(--danger)">-5%</span></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card stat-box">
Â  Â  Â  Â  Â  <div class="stat-title">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
Â  Â  Â  Â  Â  <div class="stat-value" id="statNet">0</div>
Â  Â  Â  Â  Â  <div class="small muted">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ <span style="color:var(--success)">+7%</span></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="card">
Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center">
Â  Â  Â  Â  Â  <h3 style="margin:0">Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3>
Â  Â  Â  Â  Â  <div class="muted">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <canvas id="chartMonthly" height="120" style="margin-top:12px"></canvas>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â  Â  <section id="tab-cars" class="tab" style="display:none">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center">
Â  Â  Â  Â  Â  <h3 style="margin:0">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h3>
Â  Â  Â  Â  Â  <div class="muted">Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="margin-top:12px" class="row">
Â  Â  Â  Â  Â  <div class="col"><input id="carName" placeholder="Ø§Ø³Ù…/Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ù…Ø«Ù„Ø§Ù‹: Toyota Corolla 2019)" /></div>
Â  Â  Â  Â  Â  <div style="width:160px"><input id="carPlate" placeholder="Ø§Ù„Ù„ÙˆØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" /></div>
Â  Â  Â  Â  Â  <div style="width:160px"><input id="carDailyRent" placeholder="Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ" type="number" min="0" step="0.01" /></div>
Â  Â  Â  Â  Â  <div style="width:120px"><button id="btnAddCar" class="btn">Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©</button></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="margin-top:14px">
Â  Â  Â  Â  Â  <table id="carsTable">
Â  Â  Â  Â  Â  Â  <thead><tr><th>Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><th>Ø§Ù„Ù„ÙˆØ­Ø©</th><th>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ</th><th>Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
Â  Â  Â  Â  Â  Â  <tbody></tbody>
Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â  Â  <section id="tab-entries" class="tab" style="display:none">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3 style="margin:0">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¯Ø®Ø§Ù„ (Ø¥ÙŠØ±Ø§Ø¯/Ù…ØµØ±ÙˆÙ)</h3>
Â  Â  Â  Â  <div class="muted">Ø³Ø¬Ù„ Ø¥ÙŠØ±Ø§Ø¯Ø§Ù‹ Ø£Ùˆ Ù…ØµØ±ÙˆÙØ§Ù‹ Ù„Ø£ÙŠ Ø³ÙŠØ§Ø±Ø©</div>

Â  Â  Â  Â  <div style="margin-top:12px" class="row">
Â  Â  Â  Â  Â  <div class="col"><select id="entryCar"><option value="all">Ø§Ø®ØªØ± Ø³ÙŠØ§Ø±Ø©</option></select></div>
Â  Â  Â  Â  Â  <div style="width:170px"><input id="entryDate" type="date" /></div>
Â  Â  Â  Â  Â  <div style="width:140px">
Â  Â  Â  Â  Â  Â  <select id="entryType"><option value="income">Ø¥ÙŠØ±Ø§Ø¯</option><option value="expense">Ù…ØµØ±ÙˆÙ</option></select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="margin-top:10px" class="row">
Â  Â  Â  Â  Â  <div class="col"><input id="entryAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø±Ù‚Ù…ÙŠ)" type="number" step="0.01" /></div>
Â  Â  Â  Â  Â  <div class="col"><input id="entryCategory" placeholder="Ø§Ù„ÙØ¦Ø© (Ù…Ø«Ù„Ø§Ù‹: Ø¥ÙŠØ¬Ø§Ø±ØŒ ÙˆÙ‚ÙˆØ¯ØŒ ØµÙŠØ§Ù†Ø©)" /></div>
Â  Â  Â  Â  Â  <div style="width:160px"><button id="btnAddEntry" class="btn">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</button></div>
Â  Â  Â  Â  </div>

Â  Â  Â  </div>

Â  Â  Â  <div class="card">
Â  Â  Â  Â  <div style="display:flex;justify-content:space-between;align-items:center">
Â  Â  Â  Â  Â  <h3 style="margin:0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª</h3>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <select id="filterCar" style="width:140px"><option value="all">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option></select>
Â  Â  Â  Â  Â  Â  <input id="filterFrom" type="date" style="width:140px" />
Â  Â  Â  Â  Â  Â  <input id="filterTo" type="date" style="width:140px" />
Â  Â  Â  Â  Â  Â  <button id="btnApplyFilter" class="btn ghost">ØªØ·Ø¨ÙŠÙ‚</button>
Â  Â  Â  Â  Â  Â  <button id="btnClearFilter" class="btn ghost">Ù…Ø³Ø­</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="margin-top:12px;overflow:auto">
Â  Â  Â  Â  Â  <table id="entriesTable">
Â  Â  Â  Â  Â  Â  <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
Â  Â  Â  Â  Â  Â  <tbody></tbody>
Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â  Â  <section id="tab-reports" class="tab" style="display:none">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3 style="margin:0">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
Â  Â  Â  Â  <div class="muted">Ø£Ù†Ø´Ø¦ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ù„Ø®ØµØ©ØŒ Ø´Ù‡Ø±ÙŠØ© Ø£Ùˆ Ù…Ø®ØµØµØ© ÙˆÙ‚Ù… Ø¨ØªØµØ¯ÙŠØ±Ù‡Ø§ ÙƒÙ€ PDF / Excel / CSV</div>

Â  Â  Â  Â  <div style="margin-top:12px" class="row">
Â  Â  Â  Â  Â  <div class="col"><select id="reportCar"><option value="all">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option></select></div>
Â  Â  Â  Â  Â  <div style="width:170px"><input id="reportFrom" type="date" /></div>
Â  Â  Â  Â  Â  <div style="width:170px"><input id="reportTo" type="date" /></div>
Â  Â  Â  Â  Â  <div style="width:130px"><button id="btnGenerate" class="btn">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="margin-top:12px" id="reportSummary" class="card">
Â  Â  Â  Â  Â  <p class="muted">Ø§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‡Ù†Ø§.</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="margin-top:8px;display:flex;gap:8px">
Â  Â  Â  Â  Â  <button id="btnExportCSVReport" class="btn ghost">ØªØµØ¯ÙŠØ± CSV</button>
Â  Â  Â  Â  Â  <button id="btnExportXLS" class="btn ghost">ØªØµØ¯ÙŠØ± Excel</button>
Â  Â  Â  Â  Â  <button id="btnExportPDF" class="btn">ØªØµØ¯ÙŠØ± PDF</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â  Â  <section id="tab-backup" class="tab" style="display:none">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</h3>
Â  Â  Â  Â  <div class="muted">Ù‚Ù… Ø¨ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨ØµÙŠØºØ© JSON Ø£Ùˆ Ø§Ø³ØªØ¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù. Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙŠØ­ÙØ¸ Ù†Ø³Ø®Ø© ÙÙŠ localStorage.</div>
Â  Â  Â  Â  <div style="margin-top:12px" class="row">
Â  Â  Â  Â  Â  <div style="width:160px"><button id="btnDownload" class="btn">ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button></div>
Â  Â  Â  Â  Â  <div style="width:160px"><button id="btnUpload" class="btn ghost">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button></div>
Â  Â  Â  Â  Â  <div style="width:200px"><button id="btnClearAll" class="btn ghost" style="background:#fee2e2;color:var(--danger)">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â  Â  <section id="tab-settings" class="tab" style="display:none">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
Â  Â  Â  Â  <div class="muted">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ù„Ø¹Ù…Ù„Ø©ØŒ ÙØ§ØµÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ Ø§Ù„Ø³Ù…Ø©)</div>

Â  Â  Â  Â  <div style="margin-top:12px">
Â  Â  Â  Â  Â  <div class="settings-line">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700">Ø§Ù„Ø¹Ù…Ù„Ø©</div>
Â  Â  Â  Â  Â  Â  Â  <div class="muted">Ø§Ø®ØªØ± Ø¹Ù…Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="width:200px"><input id="settingCurrency" value="MRU" /></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="settings-line">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700">ÙØ§ØµÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</div>
Â  Â  Â  Â  Â  Â  Â  <div class="muted">Ø¹Ù†Ø¯ ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ ÙŠØ­Ø¯Ø¯ Ù‡Ø°Ø§ Ø§Ù„ÙØ§ØµÙ„ ÙƒÙ… Ù…Ø±Ø© ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="width:220px"><input id="settingAutoInterval" type="number" min="1" value="60" /></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="settings-line">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700">Ø§Ù„Ø³Ù…Ø©</div>
Â  Â  Â  Â  Â  Â  Â  <div class="muted">ÙØ§ØªØ­ / Ø¯Ø§ÙƒÙ† (Ø³Ù…Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="width:160px">
Â  Â  Â  Â  Â  Â  Â  <select id="settingTheme"><option value="light">ÙØ§ØªØ­</option><option value="dark">Ø¯Ø§ÙƒÙ†</option></select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â  Â  <section id="tab-users" class="tab" style="display:none">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø±</h3>
Â  Â  Â  Â  <div class="muted">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù…ØµØ§Ø¯Ù‚Ø© ÙˆÙ‡Ù…ÙŠØ©). ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø´Ø±Ù Ø¥Ù†Ø´Ø§Ø¡/Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªØ¹ÙŠÙŠÙ† Ø£Ø¯ÙˆØ§Ø±.</div>

Â  Â  Â  Â  <div style="margin-top:12px" class="row">
Â  Â  Â  Â  Â  <div class="col"><input id="newUserName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" /></div>
Â  Â  Â  Â  Â  <div class="col"><input id="newUserEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" /></div>
Â  Â  Â  Â  Â  <div style="width:160px"><select id="newUserRole"><option value="admin">Ù…Ø´Ø±Ù</option><option value="manager">Ù…Ø¯ÙŠØ±</option><option value="user">Ù…Ø³ØªØ®Ø¯Ù…</option></select></div>
Â  Â  Â  Â  Â  <div style="width:120px"><button id="btnAddUser" class="btn">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="margin-top:12px">
Â  Â  Â  Â  Â  <table id="usersTable"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody></tbody></table>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  </main>
</div>

<div id="modalLogin" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.5);align-items:center;justify-content:center;z-index:50">
Â  <div style="background:#fff;padding:18px;border-radius:12px;width:420px; text-align: right;">
Â  Â  <h3 style="margin:0 0 8px 0">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ÙˆÙ‡Ù…ÙŠ)</h3>
Â  Â  <div class="small">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠÙˆÙ†: admin@demo (Ù…Ø´Ø±Ù)ØŒ manager@demo (Ù…Ø¯ÙŠØ±)ØŒ user@demo (Ù…Ø³ØªØ®Ø¯Ù…) â€” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: 123456</div>
Â  Â  <div style="margin-top:12px" class="row">
Â  Â  Â  <div class="col"><input id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" value="admin@demo" /></div>
Â  Â  Â  <div style="width:160px"><input id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value="123456" /></div>
Â  Â  Â  </div>
Â  Â  <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
Â  Â  Â  <button id="btnDoLogin" class="btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
Â  Â  Â  <button id="btnCloseLogin" class="btn ghost">Ø¥ØºÙ„Ø§Ù‚</button>
Â  Â  </div>
Â  </div>
</div>

<script>
/* ============================
Â  Â Mock "backend" state stored in localStorage
Â  Â ============================ */
const STORAGE_KEY = 'car_rental_pro_v1';
const AUTO_BACKUP_KEY = 'car_rental_pro_autobackup';
const LAST_RENT_DATE_KEY = 'cr_last_rent_date';

// Default initial state
function defaultState(){
Â  const today = new Date().toISOString().slice(0,10);
Â  return {
Â  Â  users:[
Â  Â  Â  {id:1,name:'Administrator',email:'admin@demo',password:'123456',role:'admin'},
Â  Â  Â  {id:2,name:'Manager',email:'manager@demo',password:'123456',role:'manager'},
Â  Â  Â  {id:3,name:'Staff',email:'user@demo',password:'123456',role:'user'}
Â  Â  ],
Â  Â  cars:[
Â  Â  Â  {id: 'c1', name:'Toyota Corolla 2019', plate:'T-1234', dailyRent: 1500},
Â  Â  Â  {id: 'c2', name:'Hyundai Accent 2018', plate:'H-4321', dailyRent: 900}
Â  Â  ],
Â  Â  entries:[
Â  Â  Â  {id:'e1',carId:'c1',date:today,type:'income',amount:1200,category:'Daily rent',note:'Daily rent'},
Â  Â  Â  {id:'e2',carId:'c2',date:today,type:'expense',amount:200,category:'Fuel',note:'Fuel refill'}
Â  Â  ],
Â  Â  settings:{
Â  Â  Â  currency:'MRU',
Â  Â  Â  autoBackupIntervalMinutes:60,
Â  Â  Â  theme:'light'
Â  Â  }
Â  };
}

let state = loadState();
let currentUser = JSON.parse(localStorage.getItem('cr_current_user')||'null');
let autoBackupTimer = null;

// --- Persistence
function loadState(){
Â  try{
Â  Â  const raw = localStorage.getItem(STORAGE_KEY);
Â  Â  if(!raw){ const s = defaultState(); localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); return s; }
Â  Â  return JSON.parse(raw);
Â  }catch(e){
Â  Â  console.error('failed load',e); const s = defaultState(); localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); return s;
Â  }
}
function saveState(){
Â  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* ============================
Â  Â General Helpers
Â  Â ============================ */
// Helper to escape HTML to prevent XSS
function escapeHtml(str) {
Â  if (typeof str !== 'string') return str;
Â  return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
}

// Helper to format currency
function formatMoney(amount) {
Â  const currency = state.settings.currency || 'MRU';
Â  // Ø§Ø³ØªØ®Ø¯Ø§Ù… toLocaleString Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£ÙØ¶Ù„
Â  return Number(amount).toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 2 }).replace('$', '').trim() + ' ' + currency;
}

// Helper to download file
function downloadFile(filename, contentType, content) {
Â  const a = document.createElement('a');
Â  const blob = new Blob([content], { type: contentType });
Â  a.href = URL.createObjectURL(blob);
Â  a.download = filename;
Â  document.body.appendChild(a);
Â  a.click();
Â  document.body.removeChild(a);
}


/* ============================
Â  Â Daily Rent Automation Logic
Â  Â ============================ */
function processDailyRent(){
Â  const today = new Date().toISOString().slice(0,10);
Â  const lastRentDate = localStorage.getItem(LAST_RENT_DATE_KEY);
Â  
Â  // Check if daily rent was already processed today
Â  if(lastRentDate === today) {
Â  Â  console.log('Daily rent already processed for today:', today);
Â  Â  return;
Â  }

Â  console.log('Processing daily rent for', today);
Â  
Â  state.cars.forEach(car => {
Â  Â  const rent = parseFloat(car.dailyRent);
Â  Â  if(rent > 0){
Â  Â  Â  // Check for duplicates before adding
Â  Â  Â  const isAlreadyAdded = state.entries.some(e => 
Â  Â  Â  Â  e.carId === car.id && 
Â  Â  Â  Â  e.date === today && 
Â  Â  Â  Â  e.category === 'Daily Automated Rent'
Â  Â  Â  );
Â  Â  Â  if (!isAlreadyAdded) {
Â  Â  Â  Â  const id = 'e'+Date.now().toString(36) + Math.random().toString(36).substring(2, 6);
Â  Â  Â  Â  state.entries.push({
Â  Â  Â  Â  Â  id: id,
Â  Â  Â  Â  Â  carId: car.id,
Â  Â  Â  Â  Â  date: today,
Â  Â  Â  Â  Â  type: 'income',
Â  Â  Â  Â  Â  amount: rent,
Â  Â  Â  Â  Â  category: 'Daily Automated Rent',
Â  Â  Â  Â  Â  note: `Daily Rent - Car: ${car.name}`
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  }
Â  });

Â  // Save new state and mark today as processed
Â  if(state.cars.some(c => parseFloat(c.dailyRent) > 0)){
Â  Â  saveState();
Â  Â  localStorage.setItem(LAST_RENT_DATE_KEY, today);
Â  Â  console.log('Daily rent added successfully.');
Â  }
}


/* ============================
Â  Â UI helpers & rendering
Â  Â ============================ */
const tabs = Array.from(document.querySelectorAll('[data-tab]')).map(b=>b.dataset.tab);
document.querySelectorAll('#nav button').forEach(btn=>{
Â  btn.addEventListener('click', ()=> {
Â  Â  document.querySelectorAll('#nav button').forEach(x=>x.classList.remove('active'));
Â  Â  btn.classList.add('active');
Â  Â  showTab(btn.dataset.tab);
Â  });
});

function showTab(id){
Â  document.querySelectorAll('.tab').forEach(t=>t.style.display='none');
Â  const el = document.getElementById('tab-'+id);
Â  if(el) el.style.display='block';
Â  // render if needed
Â  if(id==='cars') renderCarsTable();
Â  if(id==='entries') renderEntriesTable();
Â  if(id==='reports') renderReportSummary();
Â  if(id==='backup') {}
Â  if(id==='users') renderUsers();
Â  if(id==='dashboard') updateDashboard();
Â  // update UI user label
Â  document.getElementById('uiUser').innerText = currentUser ? `${currentUser.name} (${currentUser.role})` : 'Guest';
}

/* ---- Chart ---- */
let monthlyChart = null;
function updateMonthlyChart(){
Â  // build last 12 months sums
Â  const now = new Date();
Â  const months = [];
Â  const revData = [], expData = [];
Â  for(let i=11;i>=0;i--){
Â  Â  const d = new Date(now.getFullYear(), now.getMonth()-i, 1);
Â  Â  const key = d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0');
Â  Â  months.push(d.toLocaleString('default',{month:'short',year:'numeric'}));
Â  Â  const entries = state.entries.filter(en=> en.date.startsWith(key));
Â  Â  const rev = entries.filter(e=>e.type==='income').reduce((s,e)=>s+Number(e.amount),0);
Â  Â  const exp = entries.filter(e=>e.type==='expense').reduce((s,e)=>s+Number(e.amount),0);
Â  Â  revData.push(rev); expData.push(exp);
Â  }

Â  const ctx = document.getElementById('chartMonthly').getContext('2d');
Â  if(monthlyChart) monthlyChart.destroy();
Â  monthlyChart = new Chart(ctx, {
Â  Â  type:'line',
Â  Â  data:{
Â  Â  Â  labels: months,
Â  Â  Â  datasets:[
Â  Â  Â  Â  {label:'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', data:revData, tension:0.3, borderColor:'#06b6d4', backgroundColor:'rgba(6,182,212,0.06)', fill:true},
Â  Â  Â  Â  {label:'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', data:expData, tension:0.3, borderColor:'#ef4444', backgroundColor:'rgba(239,68,68,0.06)', fill:true}
Â  Â  Â  ]
Â  Â  },
Â  Â  options:{responsive:true,plugins:{legend:{position:'top'}}}
Â  });
}

/* ---- Dashboard numbers ---- */
function updateDashboard(){
Â  const rev = state.entries.filter(e=>e.type==='income').reduce((s,e)=>s+Number(e.amount),0);
Â  const exp = state.entries.filter(e=>e.type==='expense').reduce((s,e)=>s+Number(e.amount),0);
Â  document.getElementById('statRevenue').innerText = formatMoney(rev);
Â  document.getElementById('statExpenses').innerText = formatMoney(exp);
Â  document.getElementById('statNet').innerText = formatMoney(rev-exp);
Â  updateMonthlyChart();
}

/* ---- Cars table ---- */
function renderCarsTable(){
Â  const tbody = document.querySelector('#carsTable tbody'); tbody.innerHTML='';
Â  state.cars.forEach(c=>{
Â  Â  const count = state.entries.filter(e=>e.carId===c.id).length;
Â  Â  const tr = document.createElement('tr');
Â  Â  tr.innerHTML = `<td>${escapeHtml(c.name)}</td>
Â  Â  Â  <td>${escapeHtml(c.plate || '')}</td>
Â  Â  Â  <td style="font-weight:700">${formatMoney(c.dailyRent || 0)}</td>
Â  Â  Â  <td class="muted">${count} Ø¥Ø¯Ø®Ø§Ù„Ø§Øª</td>
Â  Â  Â  <td style="text-align:left">
Â  Â  Â  Â  <button class="btn ghost" data-act="edit" data-id="${c.id}">ØªØ¹Ø¯ÙŠÙ„</button>
Â  Â  Â  Â  <button class="btn" data-act="del" data-id="${c.id}" style="background:#fee2e2;color:var(--danger)">Ø­Ø°Ù</button>
Â  Â  Â  </td>`;
Â  Â  tbody.appendChild(tr);
Â  });
}

/* ---- Entries list & form ---- */
function populateCarSelects(){
Â  const selects = ['entryCar','filterCar','reportCar'];
Â  selects.forEach(id=>{
Â  Â  const el = document.getElementById(id);
Â  Â  if(!el) return;
Â  Â  const currentVal = el.value; // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
Â  Â  el.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>';
Â  Â  state.cars.forEach(c=> el.insertAdjacentHTML('beforeend', `<option value="${c.id}">${escapeHtml(c.name)}</option>`));
Â  Â  el.value = currentVal; // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
Â  });
}

function renderEntriesTable(){
Â  populateCarSelects();
Â  const tbody = document.querySelector('#entriesTable tbody'); tbody.innerHTML='';
Â  let rows = state.entries.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
Â  // apply filter if any
Â  const carFilter = document.getElementById('filterCar').value;
Â  const from = document.getElementById('filterFrom').value;
Â  const to = document.getElementById('filterTo').value;
Â  if(carFilter && carFilter!=='all') rows = rows.filter(r=> r.carId===carFilter);
Â  if(from) rows = rows.filter(r=> r.date >= from);
Â  if(to) rows = rows.filter(r=> r.date <= to);

Â  rows.forEach((e)=>{
Â  Â  const car = state.cars.find(c=>c.id===e.carId);
Â  Â  const tr = document.createElement('tr');
Â  Â  const typeTag = e.type==='income' ? '<span class="tag in">Ø¥ÙŠØ±Ø§Ø¯</span>' : '<span class="tag out">Ù…ØµØ±ÙˆÙ</span>';
Â  Â  tr.innerHTML = `<td>${e.date}</td>
Â  Â  Â  <td>${escapeHtml(car?car.name:'-')}</td>
Â  Â  Â  <td>${typeTag}</td>
Â  Â  Â  <td>${escapeHtml(e.category||'')}</td>
Â  Â  Â  <td style="font-weight:800">${formatMoney(e.amount)}</td>
Â  Â  Â  <td>${escapeHtml(e.note||'')}</td>
Â  Â  Â  <td style="text-align:left">
Â  Â  Â  Â  <button class="btn ghost" data-act="edit-entry" data-id="${e.id}">ØªØ¹Ø¯ÙŠÙ„</button>
Â  Â  Â  Â  <button class="btn" data-act="del-entry" data-id="${e.id}" style="background:#fee2e2;color:var(--danger)">Ø­Ø°Ù</button>
Â  Â  Â  </td>`;
Â  Â  tbody.appendChild(tr);
Â  });
}

/* ---- Reports ---- */
function renderReportSummary(){
Â  const carId = document.getElementById('reportCar').value;
Â  const from = document.getElementById('reportFrom').value;
Â  const to = document.getElementById('reportTo').value;
Â  let rows = state.entries.slice();
Â  if(carId && carId!=='all') rows = rows.filter(r=>r.carId===carId);
Â  if(from) rows = rows.filter(r=>r.date>=from);
Â  if(to) rows = rows.filter(r=>r.date<=to);
Â  const income = rows.filter(r=>r.type==='income').reduce((s,r)=>s+Number(r.amount),0);
Â  const expense = rows.filter(r=>r.type==='expense').reduce((s,r)=>s+Number(r.amount),0);
Â  const net = income - expense;
Â  const out = document.getElementById('reportSummary');
Â  out.innerHTML = `<div style="display:flex;gap:16px; flex-wrap: wrap;">
Â  Â  <div class="card" style="flex:1; min-width: 150px;"><div class="muted">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div><div style="font-weight:800;font-size:20px">${formatMoney(income)}</div></div>
Â  Â  <div class="card" style="flex:1; min-width: 150px;"><div class="muted">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div><div style="font-weight:800;font-size:20px">${formatMoney(expense)}</div></div>
Â  Â  <div class="card" style="flex:1; min-width: 150px;"><div class="muted">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div><div style="font-weight:800;font-size:20px">${formatMoney(net)}</div></div>
Â  Â  </div>
Â  Â  <div style="margin-top:12px">
Â  Â  Â  <table style="width:100%"><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th></tr></thead>
Â  Â  Â  <tbody>${rows.map(r=>`<tr><td>${r.date}</td><td>${escapeHtml((state.cars.find(c=>c.id===r.carId)||{}).name||'-')}</td><td>${r.type === 'income' ? 'Ø¥ÙŠØ±Ø§Ø¯' : 'Ù…ØµØ±ÙˆÙ'}</td><td>${r.category}</td><td style="font-weight:700">${formatMoney(r.amount)}</td></tr>`).join('')}</tbody></table>
Â  Â  </div>`;
}

// Export report CSV
document.getElementById('btnExportCSVReport').addEventListener('click', ()=>{
Â  const carId = document.getElementById('reportCar').value;
Â  const from = document.getElementById('reportFrom').value;
Â  const to = document.getElementById('reportTo').value;
Â  let rows = state.entries.slice();
Â  if(carId && carId!=='all') rows = rows.filter(r=>r.carId===carId);
Â  if(from) rows = rows.filter(r=>r.date>=from); if(to) rows = rows.filter(r=>r.date<=to);
Â  let csv = 'Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ø³ÙŠØ§Ø±Ø©,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„ÙØ¦Ø©,Ø§Ù„Ù…Ø¨Ù„Øº\n';
Â  rows.forEach(r=> csv += `${r.date},${(state.cars.find(c=>c.id===r.carId)||{}).name || ''},${r.type === 'income' ? 'Ø¥ÙŠØ±Ø§Ø¯' : 'Ù…ØµØ±ÙˆÙ'},${r.category || ''},${r.amount}\n`);
Â  downloadFile('report.csv', 'text/csv;charset=utf-8;', csv);
});

// Export report Excel (SheetJS)
document.getElementById('btnExportXLS').addEventListener('click', ()=>{
Â  const carId = document.getElementById('reportCar').value;
Â  const from = document.getElementById('reportFrom').value;
Â  const to = document.getElementById('reportTo').value;
Â  let rows = state.entries.slice();
Â  if(carId && carId!=='all') rows = rows.filter(r=>r.carId===carId);
Â  if(from) rows = rows.filter(r=>r.date>=from); if(to) rows = rows.filter(r=>r.date<=to);
Â  const wsData = [['Ø§Ù„ØªØ§Ø±ÙŠØ®','Ø§Ù„Ø³ÙŠØ§Ø±Ø©','Ø§Ù„Ù†ÙˆØ¹','Ø§Ù„ÙØ¦Ø©','Ø§Ù„Ù…Ø¨Ù„Øº']];
Â  rows.forEach(r=> wsData.push([r.date,(state.cars.find(c=>c.id===r.carId)||{}).name||'',r.type === 'income' ? 'Ø¥ÙŠØ±Ø§Ø¯' : 'Ù…ØµØ±ÙˆÙ',r.category||'',r.amount]));
Â  const wb = XLSX.utils.book_new();
Â  const ws = XLSX.utils.aoa_to_sheet(wsData);
Â  XLSX.utils.book_append_sheet(wb, ws, 'Report');
Â  XLSX.writeFile(wb, 'report.xlsx');
});

// Export report PDF (jsPDF)
document.getElementById('btnExportPDF').addEventListener('click', async ()=>{
Â  const { jsPDF } = window.jspdf;
Â  const doc = new jsPDF({unit:'pt',format:'a4'});
Â  doc.setFontSize(14); 
Â  doc.text('Car Rental Report',40,40); // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¯Ø¹Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ ÙÙŠ jsPDF Ø¨Ø¯ÙˆÙ† Ø®Ø·ÙˆØ· Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø¹Ù‚Ø¯Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¨Ø³ÙŠØ·.
Â  // add summary text (simple text copy as Arabic font isn't loaded)
Â  doc.setFontSize(10);
Â  doc.text('Summary:',40,60);
Â  const income = state.entries.filter(r=>r.type==='income').reduce((s,r)=>s+Number(r.amount),0);
Â  const expense = state.entries.filter(r=>r.type==='expense').reduce((s,r)=>s+Number(r.amount),0);
Â  const net = income - expense;
Â  doc.text(`Revenue: ${formatMoney(income)} | Expenses: ${formatMoney(expense)} | Net: ${formatMoney(net)}`, 40, 75);
Â  doc.save('report.pdf');
});

/* ---- Users ---- */
function renderUsers(){
Â  const tbody = document.querySelector('#usersTable tbody'); tbody.innerHTML='';
Â  state.users.forEach(u=>{
Â  Â  const tr = document.createElement('tr');
Â  Â  tr.innerHTML = `<td>${escapeHtml(u.name)}</td><td>${escapeHtml(u.email)}</td><td>${escapeHtml(u.role)}</td>
Â  Â  Â  <td style="text-align:left">
Â  Â  Â  Â  <button class="btn ghost" data-act="impersonate" data-id="${u.id}">Ø§Ù†ØªØ­Ø§Ù„</button>
Â  Â  Â  Â  <button class="btn" data-act="del-user" data-id="${u.id}" style="background:#fee2e2;color:var(--danger)">Ø­Ø°Ù</button>
Â  Â  Â  </td>`;
Â  Â  tbody.appendChild(tr);
Â  });
}

/* ============================
Â  Â Events & actions
Â  Â ============================ */

// Add car
document.getElementById('btnAddCar').addEventListener('click', ()=>{
Â  const name = document.getElementById('carName').value.trim();
Â  const plate = document.getElementById('carPlate').value.trim();
Â  const dailyRent = parseFloat(document.getElementById('carDailyRent').value) || 0;
Â  if(!name) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
Â  const id = 'c'+Date.now().toString(36) + Math.random().toString(36).substring(2, 6); // ØªÙˆÙ„ÙŠØ¯ ID ÙØ±ÙŠØ¯
Â  state.cars.push({id,name,plate,dailyRent});
Â  saveState(); 
Â  document.getElementById('carName').value=''; 
Â  document.getElementById('carPlate').value='';
Â  document.getElementById('carDailyRent').value='';
Â  renderCarsTable(); populateCarSelects(); updateDashboard();
});

// Cars actions (edit/delete)
document.querySelector('#carsTable tbody').addEventListener('click', (ev)=>{
Â  const btn = ev.target.closest('button'); if(!btn) return;
Â  const act = btn.dataset.act; const id = btn.dataset.id;
Â  if(act==='del'){
Â  Â  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ¥Ø¯Ø®Ø§Ù„Ø§ØªÙ‡Ø§ØŸ')) return;
Â  Â  state.cars = state.cars.filter(c=>c.id!==id);
Â  Â  state.entries = state.entries.filter(e=>e.carId!==id);
Â  Â  saveState(); renderCarsTable(); renderEntriesTable(); updateDashboard();
Â  } else if(act==='edit'){
Â  Â  const car = state.cars.find(c=>c.id===id);
Â  Â  const newName = prompt('Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©', car.name);
Â  Â  const newRent = prompt('Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ', car.dailyRent);
Â  Â  let updated = false;
Â  Â  if(newName !== null && newName !== car.name){ car.name=newName; updated = true; }
Â  Â  if(newRent !== null && parseFloat(newRent) !== car.dailyRent){ car.dailyRent=parseFloat(newRent) || 0; updated = true; }
Â  Â  
Â  Â  if(updated){ saveState(); renderCarsTable(); populateCarSelects(); renderEntriesTable(); updateDashboard(); }
Â  }
});

// Add entry
document.getElementById('btnAddEntry').addEventListener('click', ()=>{
Â  const carId = document.getElementById('entryCar').value;
Â  const date = document.getElementById('entryDate').value || new Date().toISOString().slice(0,10);
Â  const type = document.getElementById('entryType').value;
Â  const amount = parseFloat(document.getElementById('entryAmount').value);
Â  const category = document.getElementById('entryCategory').value.trim();
Â  
Â  if(!carId || carId==='all') return alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³ÙŠØ§Ø±Ø©'); 
Â  if(isNaN(amount) || amount<=0) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
Â  
Â  const id = 'e'+Date.now().toString(36) + Math.random().toString(36).substring(2, 6);
Â  state.entries.push({id,carId,date,type,amount,category,note:''});
Â  saveState(); 
Â  document.getElementById('entryAmount').value=''; 
Â  document.getElementById('entryCategory').value='';
Â  renderEntriesTable(); updateDashboard();
});

// Entries table actions
document.querySelector('#entriesTable tbody').addEventListener('click', (ev)=>{
Â  const btn = ev.target.closest('button'); if(!btn) return;
Â  const act = btn.dataset.act; const id = btn.dataset.id;
Â  if(act==='del-entry'){ 
Â  Â  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ØŸ')) return; 
Â  Â  state.entries = state.entries.filter(e=>e.id!==id); 
Â  Â  saveState(); renderEntriesTable(); updateDashboard(); 
Â  }
Â  if(act==='edit-entry'){ 
Â  Â  const e = state.entries.find(x=>x.id===id); 
Â  Â  const newAmt = prompt('Ø§Ù„Ù…Ø¨Ù„Øº', e.amount); 
Â  Â  if(newAmt!==null){ 
Â  Â  Â  e.amount = parseFloat(newAmt) || e.amount; 
Â  Â  Â  saveState(); renderEntriesTable(); updateDashboard(); 
Â  Â  } 
Â  }
});

// Filters
document.getElementById('btnApplyFilter').addEventListener('click', ()=> renderEntriesTable());
document.getElementById('btnClearFilter').addEventListener('click', ()=> { 
Â  document.getElementById('filterCar').value='all'; 
Â  document.getElementById('filterFrom').value=''; 
Â  document.getElementById('filterTo').value=''; 
Â  renderEntriesTable(); 
});

// Report generation
document.getElementById('btnGenerate').addEventListener('click', ()=> renderReportSummary());

// Backup download
document.getElementById('btnDownload').addEventListener('click', ()=> {
Â  const blob = JSON.stringify(state, null, 2);
Â  downloadFile('backup_car_rental.json','application/json;charset=utf-8;', blob);
});

// Upload/restore backup
document.getElementById('btnUpload').addEventListener('click', ()=> {
Â  const inp = document.createElement('input'); inp.type='file'; inp.accept='.json';
Â  inp.onchange = async ()=> {
Â  Â  const file = inp.files[0]; if(!file) return;
Â  Â  const txt = await file.text();
Â  Â  try{
Â  Â  Â  const obj = JSON.parse(txt);
Â  Â  Â  // basic validation
Â  Â  Â  if(!obj.cars || !obj.entries || !obj.users){ return alert('Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­'); }
Â  Â  Â  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©ØŸ Ø³ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.')) return;
Â  Â  Â  state = obj; saveState(); renderAll(); alert('ØªÙ…Øª Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
Â  Â  }catch(err){ alert('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); }
Â  };
Â  inp.click();
});

// Clear all data (reset)
document.getElementById('btnClearAll').addEventListener('click', ()=> {
Â  if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø´ÙŠØ¡ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ')) return;
Â  state = defaultState(); saveState(); renderAll(); alert('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†');
});

// Auto backup controls
document.getElementById('autoBackupToggle').addEventListener('change', (e)=>{
Â  const enabled = e.target.checked;
Â  localStorage.setItem(AUTO_BACKUP_KEY, JSON.stringify({enabled,ts:Date.now()}));
Â  setupAutoBackup();
});
document.getElementById('btnDownloadBackup').addEventListener('click', ()=> {
Â  const copy = JSON.stringify(state, null, 2);
Â  downloadFile('autobackup.json','application/json;charset=utf-8;', copy);
});

function setupAutoBackup(){
Â  const raw = JSON.parse(localStorage.getItem(AUTO_BACKUP_KEY) || 'null');
Â  const enabled = raw && raw.enabled;
Â  const toggleEl = document.getElementById('autoBackupToggle');
Â  if (toggleEl) toggleEl.checked = !!enabled;
Â  
Â  if(autoBackupTimer) { clearInterval(autoBackupTimer); autoBackupTimer = null; }
Â  if(enabled){
Â  Â  const minutes = parseInt(document.getElementById('settingAutoInterval').value || '60',10);
Â  Â  autoBackupTimer = setInterval(()=> {
Â  Â  Â  localStorage.setItem('car_rental_pro_backup', JSON.stringify({ts:Date.now(),state}));
Â  Â  Â  console.log('Auto backup saved');
Â  Â  }, Math.max(1,minutes) * 60 * 1000);
Â  }
}

// Settings apply
document.getElementById('settingAutoInterval').addEventListener('change', ()=> { 
Â  state.settings.autoBackupIntervalMinutes = parseInt(document.getElementById('settingAutoInterval').value || '60', 10);
Â  setupAutoBackup(); 
Â  saveState(); 
});
document.getElementById('settingCurrency').addEventListener('change', ()=> { 
Â  state.settings.currency = document.getElementById('settingCurrency').value; 
Â  saveState(); 
Â  updateDashboard(); 
});
document.getElementById('settingTheme').addEventListener('change', (e)=> {
Â  state.settings.theme = e.target.value; saveState();
Â  
Â  const root = document.documentElement.style;
Â  if(e.target.value==='dark') {
Â  Â  document.body.style.background = '#0b1220';
Â  Â  document.body.style.color = '#fff';
Â  Â  // Dark theme variables
Â  Â  root.setProperty('--bg', '#1e293b');
Â  Â  root.setProperty('--sidebar', '#0f172a');
Â  Â  root.setProperty('--card', '#334155');
Â  Â  root.setProperty('--muted', '#94a3b8');
Â  } else {
Â  Â  // Light theme variables
Â  Â  document.body.style.background = 'var(--bg)';
Â  Â  document.body.style.color = '#0f1724';
Â  Â  root.setProperty('--bg', '#f5f7fb');
Â  Â  root.setProperty('--sidebar', '#131427');
Â  Â  root.setProperty('--card', '#ffffff');
Â  Â  root.setProperty('--muted', '#6b7280');
Â  }
});

// Users management
document.getElementById('btnAddUser').addEventListener('click', ()=>{
Â  const name = document.getElementById('newUserName').value.trim();
Â  const email = document.getElementById('newUserEmail').value.trim();
Â  const role = document.getElementById('newUserRole').value;
Â  if(!name||!email) return alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
Â  // Check if email already exists
Â  if(state.users.some(u => u.email === email)) return alert('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
Â  
Â  const id = Date.now();
Â  state.users.push({id,name,email,password:'123456',role});
Â  saveState(); 
Â  document.getElementById('newUserName').value = '';
Â  document.getElementById('newUserEmail').value = '';
Â  renderUsers(); alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: 123456)');
});

// Users actions
document.querySelector('#usersTable tbody').addEventListener('click', (ev)=>{
Â  const btn = ev.target.closest('button'); if(!btn) return;
Â  const act = btn.dataset.act; const id = parseInt(btn.dataset.id, 10);

Â  if(act==='del-user'){
Â  Â  // Prevent deleting the currently active user
Â  Â  if(currentUser && currentUser.id === id) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ.');
Â  Â  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
Â  Â  state.users = state.users.filter(u=>u.id!==id);
Â  Â  saveState(); renderUsers();
Â  } else if(act==='impersonate'){
Â  Â  const user = state.users.find(u=>u.id===id);
Â  Â  if(user){
Â  Â  Â  currentUser = user;
Â  Â  Â  localStorage.setItem('cr_current_user', JSON.stringify(currentUser));
Â  Â  Â  showTab('dashboard'); 
Â  Â  Â  alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€: ${user.name} (${user.role})`);
Â  Â  }
Â  }
});

// Login button actions
document.getElementById('btnLogin').addEventListener('click', ()=> {
Â  document.getElementById('modalLogin').style.display = 'flex';
});
document.getElementById('btnCloseLogin').addEventListener('click', ()=> {
Â  document.getElementById('modalLogin').style.display = 'none';
});
document.getElementById('btnDoLogin').addEventListener('click', ()=> {
Â  const email = document.getElementById('loginEmail').value.trim();
Â  const pass = document.getElementById('loginPass').value.trim();
Â  const user = state.users.find(u=> u.email===email && u.password===pass);
Â  if(user){
Â  Â  currentUser = user;
Â  Â  localStorage.setItem('cr_current_user', JSON.stringify(currentUser));
Â  Â  document.getElementById('modalLogin').style.display = 'none';
Â  Â  showTab('dashboard');
Â  Â  alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ ${user.name} (${user.role})`);
Â  }else{
Â  Â  alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­Ø©');
Â  }
});

// Initial setup to run on load
function renderAll(){
Â  populateCarSelects();
Â  // Find the currently active tab or default to 'dashboard'
Â  const activeBtn = document.querySelector('#nav button.active');
Â  const activeTabId = activeBtn ? activeBtn.dataset.tab : 'dashboard';
Â  showTab(activeTabId);
Â  
Â  // Set settings form values
Â  document.getElementById('settingCurrency').value = state.settings.currency;
Â  document.getElementById('settingAutoInterval').value = state.settings.autoBackupIntervalMinutes;
Â  document.getElementById('settingTheme').value = state.settings.theme;
Â  
Â  // Apply initial theme setting on load
Â  const themeEvent = new Event('change');
Â  document.getElementById('settingTheme').dispatchEvent(themeEvent);

Â  // Set initial user display
Â  document.getElementById('uiUser').innerText = currentUser ? `${currentUser.name} (${currentUser.role})` : 'Guest';

Â  // Set auto backup toggle state
Â  const rawBackup = JSON.parse(localStorage.getItem(AUTO_BACKUP_KEY) || 'null');
Â  const isAutoBackupEnabled = rawBackup && rawBackup.enabled;
Â  if (document.getElementById('autoBackupToggle')) {
Â  Â  document.getElementById('autoBackupToggle').checked = isAutoBackupEnabled;
Â  }
}

document.addEventListener('DOMContentLoaded', ()=> {
Â  // Process daily rent before rendering dashboard
Â  processDailyRent();
Â  renderAll();
Â  setupAutoBackup();
Â  // Set default date for entry
Â  document.getElementById('entryDate').value = new Date().toISOString().slice(0,10);
});
</script>
</body>
</html>